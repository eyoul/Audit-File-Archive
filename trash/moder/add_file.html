{% extends 'base.html' %}

{% block nav %}

{% endblock %}

{% block content %}
<section class="section1">
   <ul class="tree-menu">
    {% for division in divisions %}
    <li>
      <a href="#">{{ division.name }}</a>
        <ul>
        {% for department in departments if department.division_id == division.id %}
            <li>
                <a href="#">{{ department.name }}</a>
                <ul>
                {% for unit in units if unit.department_id == department.id %}
                    <li>
                       <a href="#">{{ unit.name }}</a>
                        <ul>
                        {% for document in documents if document.unit_id == unit.id %}
                            <li><a href="#" data-file="{{ url_for('post.download_file', filename=document.file_path) }}" data-type="{{ document.file_type }}">{{ document.name }}</a></li>
                        {% endfor %}
                        </ul>
                    </li>
                {% endfor %}
                </ul>
                <ul>
                {% for document in documents if document.department_id == department.id and document.unit_id is none %}
                    <li><a href="#" data-file="{{ url_for('post.download_file', filename=document.file_path) }}" data-type="{{ document.file_type }}">{{ document.name }}</a></li>
                {% endfor %}
                </ul>
            </li>
        {% endfor %}
        </ul>
        <ul>
        {% for document in documents if document.division_id == division.id and document.department_id is none and document.unit_id is none %}
            <li><a href="#" data-file="{{ url_for('post.download_file', filename=document.file_path) }}" data-type="{{ document.file_type }}">{{ document.name }}</a></li>
        {% endfor %}
        </ul>
        
    </li>
    {% endfor %}
   </ul>
</section>
<section  id="file-container">
  <object id="pdf" data="" type="application/pdf" width="100%" height="600px">
    <p>PDF cannot be displayed. Please download the PDF to view it: <a href="">Download PDF</a>.</p>
  </object>
</section>
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
<script>
var treeLinks = document.querySelectorAll('.tree-menu a');
for (var i = 0; i < treeLinks.length; i++) {
  treeLinks[i].addEventListener('click', function(event) {
    var li = this.parentNode;
    if (li.classList.contains('active')) {
      li.classList.remove('active');
    } else {
      var siblings = li.parentNode.children;
      for (var j = 0; j < siblings.length; j++) {
        if (siblings[j] !== li) {
          siblings[j].classList.remove('active');
        }
      }
      li.classList.add('active');
    }
  });
}

var links = document.querySelectorAll('.tree-menu a[data-file]');
for (var i = 0; i < links.length; i++) {
  links[i].addEventListener('click', function(event) {
    event.preventDefault();
    renderFile(this.getAttribute('data-file'), this.getAttribute('data-type'));
  });
}

function renderFile(filePath, fileType) {
  var fileContainer = document.getElementById('pdf');
  
  // Remove any existing elements from the fileContainer section
  fileContainer.innerHTML = '';
  
  if (fileType == 'pdf') {
    var object = document.createElement('object');
    object.data = filePath;
    object.type = 'application/pdf';
    object.width = '100%';
    object.height = '600px';
    fileContainer.appendChild(object);
  } else if (fileType == 'doc' || fileType == 'docx') {
    var iframe = document.createElement('iframe');
    iframe.src = "https://view.officeapps.live.com/op/embed.aspx?src=" + encodeURIComponent(filePath);
    fileContainer.appendChild(iframe);
  } else if (fileType == 'jpg' || fileType == 'jpeg' || fileType == 'png') {
    var img = document.createElement('img');
    img.src = filePath;
    fileContainer.appendChild(img);
  }
}
</script>
{% endblock %}